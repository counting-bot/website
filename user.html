<!DOCTYPE HTML>
<html lang="en">
	<head>
        <!-- Primary Meta Tags -->
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Counting</title>
        <meta name="title" content="Counting">
        <link rel="icon" href="/assets/img/CountingIconRound.png" type="image/x-icon"/>
        <meta name="description" content="The most customizable counting bot. Compete with other Discord servers to get the highest count.">
        <meta name="keywords" content="discord counting bot, counting bot, counting game, counting, counting discord">
        <meta name="theme-color" content="#a329d1">

        <!-- Open Graph / Facebook -->
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://counting.numselli.xyz">
        <meta property="og:title" content="Counting">
        <meta property="og:description" content="The most customizable counting bot. Compete with other Discord servers to get the highest count.">
        <meta property="og:image" content="https://counting.numselli.xyz/assets/img/CountingIconRound.png">

        <!-- Twitter -->
        <meta property="twitter:card" content="summary_large_image">
        <meta property="twitter:url" content="https://counting.numselli.xyz">
        <meta property="twitter:title" content="Counting">
        <meta property="twitter:description" content="The most customizable counting bot. Compete with other Discord servers to get the highest count.">
        <meta property="twitter:image" content="https://counting.numselli.xyz/assets/img/CountingIconRound.png">


        <!-- css imports -->
        <link href="/assets/css/Raleway.css" rel="stylesheet">
        <link href="/assets/css/style.css" rel="stylesheet">
        <style>.imageOverlay{position: absolute !important; top: 50%; left: 50%; transform: translate(-50%, -50%);}</style>

        <!-- js imports -->
		<!-- <script type="application/javascript" async defer data-website-id="a82646c2-8bb3-4282-b185-2098b714f83a" src="https://insights.numselli.xyz/umami.js"></script> -->
	
        <!-- materialize -->
        <link href="/assets/css/material-icons.css" rel="stylesheet">
        <script src="/assets/js/materialize.min.js"></script>

        <script type="module" src="/assets/js/navbar.js"></script>
    </head>

	<body>  
        <script>
            // event listeners
            document.addEventListener("DOMContentLoaded", async()=>{
                const navElems = document.querySelectorAll('.sidenav');
                let navInstances = M.Sidenav.init(navElems);

                const userStats = await fetch(`https://api.numselli.xyz/discordOauth/userStats`, {credentials: "include"}).catch(err=>console.error);
                if (!userStats.ok) window.location.pathname = "/login";

                const userStatsJSON =  await userStats.json()
                document.getElementById("accuracy").textContent +=` ${userStatsJSON.accuracy}`
                document.getElementById("correct").textContent += ` ${userStatsJSON.correct}`
                document.getElementById("wrong").textContent += ` ${userStatsJSON.wrong}`
                document.getElementById("total").textContent += ` ${userStatsJSON.total}`
                document.getElementById("rank").textContent += userStatsJSON.rank
                document.getElementById("savesLeft").textContent += ` ${userStatsJSON.savesLeft}/${userStatsJSON.maxSaves}`
                document.getElementById("savesUsed").textContent += ` ${userStatsJSON.savesUsed}`

                const ajaxdata = await fetch(`https://api.numselli.xyz/discordOauth/user`, {credentials: "include"}).catch(err=>console.error);
                const ajaxdataJSON =  await ajaxdata.json()
                document.getElementById('username').textContent = `${ajaxdataJSON.username}#${ajaxdataJSON.discriminator}`   
                document.getElementById("avatar").src = ajaxdataJSON.avatarURL             

                const guilds = await fetch(`https://api.numselli.xyz/discordOauth/userGuilds`, {credentials: "include"}).catch(err=>console.error);
                const guildsJson =  await guilds.json()
                guildsJson.map(guild=>{
                    if (!guild.common && !guild.canInvite) return;
                    const linkDiv = document.createElement("a")
                    const guildDiv = document.createElement("div")
                    linkDiv.href = guild.common ? `/guildScores.html?guildid=${guild.id}` : `https://discord.com/oauth2/authorize?client_id=726560538145849374&scope=bot%20applications.commands&guild_id=${guild.id}`
                    linkDiv.classList='col card-panel transparent'
                    linkDiv.style= `text-align: center;`

                    const imgNode = document.createElement("img")
                    imgNode.src = guild.iconURL
                    imgNode.alt= `${guild.name}'s guild icon`
                    imgNode.loading="lazy"
                    imgNode.style=`border-radius: 50%; filter: grayscale(${guild.common ? 0 : 90}%);`
                    imgNode.onerror=imgError
                    const imgNodeDiv = document.createElement("div")
                    imgNodeDiv.style="  position: relative;"
                    imgNodeDiv.append(imgNode)

                    if (!guild.common){
                        const imgOverlayNodeDiv = document.createElement("div")
                        imgOverlayNodeDiv.innerHTML = `<div class="btn-floating btn-large pulse"><i class="large material-icons">add_circle_outline</i></div>`
                        imgOverlayNodeDiv.classList="imageOverlay"
                        imgNodeDiv.appendChild(imgOverlayNodeDiv)
                    }
                    guildDiv.appendChild(imgNodeDiv)

                    const nameNode = document.createElement("span")
                    nameNode.textContent = guild.name
                    const nameNodeDiv = document.createElement("div")
                    nameNodeDiv.append(nameNode)
                    guildDiv.appendChild(nameNodeDiv)

                    linkDiv.appendChild(guildDiv)

                    document.getElementById("guildsDiv").appendChild(linkDiv)
                })
            });

            function imgError() {
                if (this.src != 'assets/img/error.png') this.src = 'assets/img/error.png';
            }
        </script>

        <!-- Nav -->
        <nav-bar></nav-bar>

        <!-- Main -->
        <div id="main" style="height: 100%; width: 100%; margin: 0 auto;">
            <article id="scores" class="panel center-align" style="width: 100%; margin: 0 auto;">
                <div class="row">
                    <div class="col s2">
                        <div class="container">
                            <img src="" alt="" id="avatar" class="circle">
                        </div>
                        <div class="container">
                            <h5 id="username"></h5>
                        </div>
                        <div class="container">
                            <h6>Global Stats</h6> 
                            <div id="accuracy">Accuracy:</div>
                            <div id="correct">‚úÖ:</div>
                            <div id="wrong">‚ùå:</div>
                            <div id="total">Total:</div>
                            <div id="savesLeft">üÜò Saves left:</div>
                            <div id="savesUsed">üÜò Saves used:</div>
                            <div id="rank">Rank: #</div>
                        </div>
                    </div>
                    <div class="col s10">
                        <div class="center-align row" id="guildsDiv"></div>
                    </div>
                </div>
            </article>
        </div>
	</body>
</html>